

spring:
  kafka:
    bootstrap-servers: localhost:9092

  redis:
    host: localhost
    port: 6379

  datasource:
    url: jdbc:postgresql://localhost:5432/jobdb
    username: postgres
    password: password

  jpa:
    hibernate:
      ddl-auto: validate
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect

kafka:
  topics:
    jobs:
      fast: jobs.fast           # Image, PDF, quick tasks
      long: jobs.long           # Video, ML, long tasks
      dlq: jobs.dlq            # Dead letter queue

# Server port
server:
  port: 8088

# Monitoring
management:
  endpoints:
    web:
      exposure:
        include: health,metrics,prometheus
  metrics:
    export:
      prometheus:
        enabled: true

storage:
  type: ${STORAGE_TYPE:minio}

  # MinIO/S3 Configuration
  endpoint: ${STORAGE_ENDPOINT:http://localhost:9000}
  access-key: ${STORAGE_ACCESS_KEY:minioadmin}
  secret-key: ${STORAGE_SECRET_KEY:minioadmin}
  region: ${STORAGE_REGION:us-east-1}
  bucket: ${STORAGE_BUCKET:file-uploads}

  # Upload Configuration
  presigned-url-duration: 3600 # 1 hour in seconds
  multipart-threshold: 10485760 # 10MB - files larger than this use multipart
  max-file-size: 26843545600 # 25GB

  # Allowed content types
  allowed-content-types:
    - image/jpeg
    - image/png
    - image/gif
    - image/webp
    - video/mp4
    - video/quicktime
    - video/x-msvideo
    - application/pdf
    - application/zip
    - application/x-zip-compressed
    - application/vnd.openxmlformats-officedocument.wordprocessingml.document
    - application/vnd.openxmlformats-officedocument.spreadsheetml.sheet
    - text/plain
    - text/csv

# Rate limiting configuration
bucket4j:
  enabled: true
  filters:
    - cache-name: buckets
      url: /api/storage/.*
      rate-limits:
        - bandwidths:
            - capacity: 100
              time: 1
              unit: hours

# Logging
logging:
  level:
    com.example.storage: INFO
    software.amazon.awssdk: WARN
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"
  file:
    name: logs/storage-service.log


